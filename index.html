<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <style>
    body { font-family: Arial; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ddd; padding: 8px; }
    button { margin: 5px; }
  </style>
</head>
<body>
  <h1>Folha de Giro - Registro Diário</h1>
  <form id="form">
    <input type="hidden" id="id" name="id">

    <h2>Informações Gerais</h2>
    Data: <input type="date" id="data" name="data"><br>
    KM Inicial: <input type="number" id="km_inicial" name="km_inicial"><br>
    Horas: <input type="number" id="horas" name="horas"><br>
    Matrícula Veículo: <input type="text" id="matricula_veiculo" name="matricula_veiculo"><br>
    Saída: <input type="time" id="saida" name="saida"><br>
    Matrícula Reboque: <input type="text" id="matricula_reboque" name="matricula_reboque"><br>
    Motorista: <input type="text" id="motorista" name="motorista"><br>
    Refeição: <input type="text" id="refeicao" name="refeicao"><br>
    Chegada: <input type="time" id="chegada" name="chegada"><br>
    Anomalias na Viatura: <textarea id="anomalias_viatura" name="anomalias_viatura"></textarea><br>

    <h2>Equipamento</h2>
    Capacete: <input type="checkbox" id="equip_capacete"><br>
    Luvas: <input type="checkbox" id="equip_luvas"><br>
    Óculos/Máscaras: <input type="checkbox" id="equip_oculos"><br>
    Botas: <input type="checkbox" id="equip_botas"><br>
    Macaco Descartável: <input type="checkbox" id="equip_macaco"><br>
    Caixa Primeiros Socorros: <input type="checkbox" id="equip_caixa"><br>
    KAD: <input type="checkbox" id="equip_kad"><br>
    Mangueiras/Acessórios: <input type="checkbox" id="equip_mangueiras"><br>

    <h2>Carga (Adicione linhas conforme necessário)</h2>
    <table id="cargoTable">
      <thead><tr><th>Hora Início</th><th>Descarca Cód</th><th>Produtor/NE-FS</th><th>Hora Início/Fim</th><th>Cliente</th><th>Local Carga</th><th>KM Início</th><th>KM Fim</th><th>Ação</th></tr></thead>
      <tbody></tbody>
    </table>
    <button type="button" onclick="addRow('cargoTable', ['hora_inicio', 'descarca_cod', 'produtor_ne_fs', 'hora_inicio_fim', 'cliente', 'local_carga', 'km_inicio', 'km_fim'])">Adicionar Carga</button>

    <h2>Dificuldades</h2>
    <table id="diffTable">
      <thead><tr><th>FS</th><th>Dificuldade</th><th>Causa</th><th>Ação</th></tr></thead>
      <tbody></tbody>
    </table>
    <button type="button" onclick="addRow('diffTable', ['fs', 'dificuldade', 'causa'])">Adicionar Dificuldade</button>

    <h2>Abastecimentos</h2>
    <table id="fuelTable">
      <thead><tr><th>Local</th><th>KM</th><th>Litros</th><th>Veículo</th><th>Ação</th></tr></thead>
      <tbody></tbody>
    </table>
    <button type="button" onclick="addRow('fuelTable', ['local', 'km', 'litros', 'veiculo'])">Adicionar Abastecimento</button>

    <br><button type="button" onclick="saveData()">Salvar/Atualizar</button>
  </form>

  <script>
    function addRow(tableId, fields) {
      const table = document.getElementById(tableId).getElementsByTagName('tbody')[0];
      const row = table.insertRow();
      fields.forEach(field => {
        const cell = row.insertCell();
        const input = document.createElement('input');
        input.type = field.includes('hora') || field.includes('saida') || field.includes('chegada') ? 'time' : field.includes('km') || field.includes('litros') ? 'number' : 'text';
        input.name = `${tableId}_${field}`;
        cell.appendChild(input);
      });
      const actionCell = row.insertCell();
      const removeBtn = document.createElement('button');
      removeBtn.textContent = 'Remover';
      removeBtn.onclick = () => row.remove();
      actionCell.appendChild(removeBtn);
    }

    function collectTableData(tableId, fields) {
      const rows = document.getElementById(tableId).getElementsByTagName('tbody')[0].rows;
      return Array.from(rows).map(row => {
        const data = {};
        fields.forEach((field, idx) => data[field] = row.cells[idx].firstChild.value || '');
        return data;
      });
    }

    function saveData() {
      const formData = {
        id: document.getElementById('id').value,
        data: document.getElementById('data').value,
        km_inicial: document.getElementById('km_inicial').value,
        horas: document.getElementById('horas').value,
        matricula_veiculo: document.getElementById('matricula_veiculo').value,
        saida: document.getElementById('saida').value,
        matricula_reboque: document.getElementById('matricula_reboque').value,
        motorista: document.getElementById('motorista').value,
        refeicao: document.getElementById('refeicao').value,
        chegada: document.getElementById('chegada').value,
        anomalias_viatura: document.getElementById('anomalias_viatura').value,
        equip_capacete: document.getElementById('equip_capacete').checked,
        equip_luvas: document.getElementById('equip_luvas').checked,
        equip_oculos: document.getElementById('equip_oculos').checked,
        equip_botas: document.getElementById('equip_botas').checked,
        equip_macaco: document.getElementById('equip_macaco').checked,
        equip_caixa: document.getElementById('equip_caixa').checked,
        equip_kad: document.getElementById('equip_kad').checked,
        equip_mangueiras: document.getElementById('equip_mangueiras').checked,
        cargo: collectTableData('cargoTable', ['hora_inicio', 'descarca_cod', 'produtor_ne_fs', 'hora_inicio_fim', 'cliente', 'local_carga', 'km_inicio', 'km_fim']),
        difficulties: collectTableData('diffTable', ['fs', 'dificuldade', 'causa']),
        fuel: collectTableData('fuelTable', ['local', 'km', 'litros', 'veiculo'])
      };

      fetch('https://script.google.com/macros/s/AKfycbxYvRtClGF_G2i_zRB06SYfkgSLrE49UNPAlgX58upwFL4iztLMRPXEGxTBGuI3ml-d/exec', {
        method: 'POST',
        body: JSON.stringify(formData)
      })
        .then(response => response.json())
        .then(result => {
          if (result.status === 'success') {
            document.getElementById('id').value = result.id;
            alert('Dados salvos com sucesso! ID: ' + result.id);
          } else {
            alert('Erro: ' + result.message);
          }
        })
        .catch(error => alert('Erro ao salvar: ' + error.message));
    }
  </script>
</body>
</html>
