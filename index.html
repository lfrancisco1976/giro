<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Folha de Giro Digital</title>
<style>
  :root {
    --primary: #2563eb;
    --primary-hover: #1e40af;
    --bg: #f1f5f9;
    --card: #ffffff;
    --border: #e2e8f0;
    --radius: 14px;
    --shadow: 0 4px 12px rgba(0,0,0,0.05);
  }

  * { box-sizing: border-box; }

  body {
    font-family: 'Inter', Arial, sans-serif;
    background: var(--bg);
    color: #111827;
    margin: 0;
    padding: 0;
  }

  header {
    background: var(--primary);
    color: #fff;
    text-align: center;
    padding: 1rem;
    font-size: 1.4rem;
    font-weight: 600;
    letter-spacing: 0.5px;
  }

  main {
    max-width: 800px;
    margin: 2rem auto;
    padding: 1rem;
  }

  .tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 1.5rem;
  }

  .tab {
    flex: 1;
    text-align: center;
    padding: 10px;
    border-radius: var(--radius);
    cursor: pointer;
    background: #e2e8f0;
    font-weight: 500;
    transition: all 0.3s;
  }

  .tab.active {
    background: var(--primary);
    color: white;
  }

  .view {
    display: none;
    background: var(--card);
    padding: 1.5rem;
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    animation: fadeIn 0.3s ease;
  }

  .view.active { display: block; }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  input, select, textarea, button {
    width: 100%;
    padding: 10px;
    margin-bottom: 12px;
    border-radius: 8px;
    border: 1px solid var(--border);
    font-size: 1rem;
  }

  button {
    background: var(--primary);
    color: #fff;
    border: none;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.3s;
  }

  button:hover { background: var(--primary-hover); }

  .cards {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
    gap: 1rem;
  }

  .card {
    background: var(--card);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    padding: 1rem;
    position: relative;
  }

  .card h3 {
    margin-top: 0;
    font-size: 1.1rem;
    color: var(--primary);
  }

  .card p { margin: 4px 0; font-size: 0.95rem; }

  .actions {
    display: flex;
    gap: 8px;
    margin-top: 10px;
  }

  .btn-edit, .btn-delete {
    flex: 1;
    border: none;
    border-radius: 6px;
    padding: 8px;
    font-weight: 600;
    cursor: pointer;
  }

  .btn-edit { background: #3b82f6; color: white; }
  .btn-edit:hover { background: #2563eb; }
  .btn-delete { background: #ef4444; color: white; }
  .btn-delete:hover { background: #dc2626; }

  @media (max-width: 600px) {
    main { padding: 0.5rem; }
    .card { font-size: 0.95rem; }
  }
</style>
</head>
<body>

<header>üöõ Folha de Giro Digital</header>

<main>
  <div class="tabs">
    <div class="tab active" onclick="showTab('novo')">Novo Giro</div>
    <div class="tab" onclick="showTab('ver')">Ver / Editar</div>
  </div>

  <!-- NOVO GIRO -->
  <div id="novo" class="view active">
    <form id="formGiro">
      <input type="hidden" name="rowId">
      <label>Data</label>
      <input type="date" name="data" required>
      <label>Motorista</label>
      <select name="motorista" required>
        <option value="">-- Selecionar --</option>
        <option>VASCO LOPES</option>
        <option>LUIS DUARTE</option>
        <option>NELSON COSTA</option>
        <option>VITOR CABEDAL</option>
      </select>
      <label>Matr√≠cula Viatura</label>
      <select name="matricula">
        <option value="">-- Selecionar --</option>
        <option>AA-84-GG</option>
        <option>11-ZH-37</option>
        <option>AL-57-LD</option>
        <option>BG-02-BS</option>
        <option>61-QG-05</option>
        <option>92-VI-02</option>
      </select>
      <label>Matr√≠cula Reboque</label>
      <input type="text" name="reboque">
      <label>Hora Sa√≠da</label>
      <input type="time" name="horaSaida">
      <label>Hora Chegada</label>
      <input type="time" name="horaChegada">
      <label>Km In√≠cio</label>
      <input type="number" name="kmInicio">
      <label>Km Fim</label>
      <input type="number" name="kmFim">
      <label>Cliente</label>
      <input type="text" name="cliente">
      <label>Local de Carga</label>
      <input type="text" name="localCarga">
      <label>NE / Produtor</label>
      <input type="text" name="ne">
      <label>Observa√ß√µes</label>
      <textarea name="obs" rows="3"></textarea>
      <button type="submit">üíæ Gravar</button>
    </form>
  </div>

  <!-- VER / EDITAR -->
  <div id="ver" class="view">
    <form id="filtroForm" style="margin-bottom:1rem;">
      <select id="fMotorista" required>
        <option value="">-- Motorista --</option>
        <option>VASCO LOPES</option>
        <option>LUIS DUARTE</option>
        <option>NELSON COSTA</option>
        <option>VITOR CABEDAL</option>
      </select>
      <input type="date" id="fData">
      <button type="submit">üîç Filtrar</button>
    </form>
    <div class="cards" id="listaGiros"></div>
  </div>
</main>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbyqaCkB_6oO1Cw2Pza7wEko3EKp0lmYleGOEOE8k07IxEk6VtOLkNpxzdA4VaWRyzQW/exec";

// Alternar tabs
function showTab(id) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.querySelector(`.tab[onclick="showTab('${id}')"]`).classList.add('active');
  document.getElementById(id).classList.add('active');
}

// Preenche data de hoje
document.querySelector('[name="data"]').valueAsDate = new Date();
document.getElementById('fData').valueAsDate = new Date();

let editIndex = null;

// Gravar ou atualizar
document.getElementById('formGiro').addEventListener('submit', async e => {
  e.preventDefault();
  const form = e.target;
  const dados = Object.fromEntries(new FormData(form).entries());
  const res = await fetch(scriptURL, { method: 'POST', body: JSON.stringify(dados) });
  const json = await res.json();
  alert(json.status === 'success' ? (editIndex ? '‚úÖ Giro atualizado!' : '‚úÖ Giro gravado!') : '‚ùå Erro ao gravar.');
  form.reset();
  editIndex = null;
  document.querySelector('[name="data"]').valueAsDate = new Date();
});

// Filtrar giros
document.getElementById('filtroForm').addEventListener('submit', async e => {
  e.preventDefault();
  const motorista = document.getElementById('fMotorista').value;
  const data = document.getElementById('fData').value;
  const url = `${scriptURL}?motorista=${encodeURIComponent(motorista)}&data=${encodeURIComponent(data)}`;
  const res = await fetch(url);
  const giros = await res.json();
  mostrarGiros(giros);
});

// Mostrar cart√µes
function mostrarGiros(giros) {
  const lista = document.getElementById('listaGiros');
  if (!giros.length) {
    lista.innerHTML = `<p style="text-align:center;">Sem registos encontrados</p>`;
    return;
  }
  lista.innerHTML = giros.map((g, i) => `
    <div class="card">
      <h3>${g.Cliente || 'Sem Cliente'}</h3>
      <p><strong>Data:</strong> ${g.Data || ''}</p>
      <p><strong>Motorista:</strong> ${g.Motorista || ''}</p>
      <p><strong>Local:</strong> ${g["Local Carga"] || ''}</p>
      <p><strong>Km:</strong> ${g["Km In√≠cio"] || ''} ‚Üí ${g["Km Fim"] || ''}</p>
      <div class="actions">
        <button class="btn-edit" onclick='editarGiro(${JSON.stringify(g)})'>Editar</button>
        <button class="btn-delete" onclick='eliminarGiro(${i})'>Eliminar</button>
      </div>
    </div>
  `).join('');
}

// Editar
function editarGiro(g) {
  showTab('novo');
  const form = document.getElementById('formGiro');
  Object.keys(g).forEach(k => {
    const campo = form.querySelector(`[name="${k}"]`);
    if (campo) campo.value = g[k];
  });
  editIndex = g.rowId || true;
}

// Eliminar (nota: Apps Script precisa suporte posterior)
async function eliminarGiro(i) {
  if (!confirm('Tem a certeza que quer eliminar este registo?')) return;
  alert('üóëÔ∏è Registo eliminado (simulado ‚Äì eliminar real requer fun√ß√£o no Apps Script).');
}
</script>
</body>
</html>
